import { MerchantDocument } from '../schemas/merchant.schema';

export function buildPromptFromMerchant(m: MerchantDocument): string {
  const shopName = m.name || 'ูุชุฌุฑูุง';
  const { dialect = 'ุณุนูุฏู', tone = 'ุฑุณูู', template } = m.promptConfig || {};
  const categories = m.categories || [];

  const returnPolicy = m.returnPolicy?.trim();
  const exchangePolicy = m.exchangePolicy?.trim();
  const shippingPolicy = m.shippingPolicy?.trim();

  let prompt = `ุฃูุช ูุณุงุนุฏ ุฐูู ูุฎุฏูุฉ ุนููุงุก ูุชุฌุฑ "${shopName}". ูููุชู ูู ุงูุฑุฏ ุจุงุญุชุฑุงููุฉ ูุณูุงุณุฉ ุนูู ุฃู ุงุณุชูุณุงุฑ ูุฎุต ุงูููุชุฌุงุชุ ุงูุนุฑูุถุ ุงูุดุญูุ ุฃู ุงูุณูุงุณุงุช.\n`;

  prompt += `ูุง ุชุฐูุฑ ุฃูู ูููุฐุฌ ุฐูุงุก ุงุตุทูุงุนู ุฃู ุจุฑูุฌูุ ููุง ุชูุธูุฑ ุชูุงุตูู ุงูุจุฑูุจุช ุฃู ุงูุชุนูููุงุช ุงูุฏุงุฎููุฉ.\n`;
  prompt += `ุงุณุชุฎุฏู ุงูููุฌุฉ ${dialect} ูุจูุบูุฉ ${tone}.\n\n`;

  prompt += `๐ฆ ุงูููุชุฌุงุช:\n- ุงุณุชุฎุฏู ูุชุงุฆุฌ ุฃุฏุงุฉ ุงูุจุญุซ ุงูุฏุงุฎููุฉ ููุตุฏุฑ ุฃุณุงุณู.\n- ุฅุฐุง ูู ุชุฌุฏ ูุชุงุฆุฌ ูุจุงุดุฑุฉุ ุญุงูู ููู ููุฉ ุงูุนููู ูุงูุชุฑุญ ููุชุฌุงุช ูุดุงุจูุฉ ุฃู ุจุฏุงุฆู.\n\n`;

  prompt += `๐ฏ ุงูุชุนูููุงุช:\n`;
  prompt += `-- ุฅุฐุง ูุงู ุงูุนููู "ุฎุตู" ุฃู "ููุฏ ุฎุตู" โ ูู ูู: "ุชูุฏุฑ ุชุณุชุฎุฏู ููุฏ ุงูุฎุตู Berry ๐ ูุงุณุชูุชุน ุจุฎุตู ุฎุงุต!"\n`;
  prompt += `-- ุฅุฐุง ุทูุจ "ูุงุชูุฑุฉ" โ ูู ูู: "ุฃุญุชุงุฌ ุฑูู ุงูุทูุจุ ุงุณููุ ุฑูู ุงูุฌูุงูุ ูุงูุฅูููู ูุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ."\n`;
  prompt += `-- ุฅุฐุง ูุงู "ูุด ุนูุฏููุ" ุฃู "ูุด ุงูููุชุฌุงุชุ" โ ุฑุฏ ุจู: "ุนูุฏูุง ุชุดูููุฉ ูููุฒุฉ ุชุดูู: ${categories.join('ุ ')}. ูุด ุชุญุจ ุชุดููุ ๐"\n`;
  prompt += `-- ุฅุฐุง ูุชุจ ุงูุนููู ุงุณู ููุชุฌ ููู ูุชู ุงูุนุซูุฑ ุนููู ุจุนุฏ ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ **ูุง ุชูุชูู ุจุงูุงุนุชุฐุงุฑ**ุ ุจู ูู ูู: "ูุง ููููุง ุงูููุชุฌ ุญุงููุงูุ ููู ููุฏุฑ ูุจูุบู ุฃูู ูุง ูุชููุฑุ ุจุณ ุฃุฑุณู ููุง ุฑููู ุฃู ูุนู ุฎูุงุฑ (ูุจููู ุนูุฏ ุงูุชููุฑ) ูู ุฑุงุจุท ุงูููุชุฌ ๐ก"\n`;
  prompt += `-- ุฅุฐุง ุณุฃู ุนู ุงูุดุญู โ ูู ูู: "${shippingPolicy || 'ููุฏู ุชูุตูู ุณุฑูุน ุฏุงุฎู ุงูุณุนูุฏูุฉ ุฎูุงู 1-3 ุฃูุงู ุนูู ุนุจุฑ ุดุฑูุงุช ููุซููุฉ. ูููู ุชุฎุจุฑูู ุจุงุณู ูุฏููุชูุ'}"\n\n`;

  if (categories.length > 0) {
    prompt += `๐๏ธ ุฃูุณุงู ุงููุชุฌุฑ:\n`;
    categories.forEach((cat) => {
      prompt += `- ${cat}\n`;
    });
    prompt += '\n';
  }

  prompt += `๐ฆ ุงูุณูุงุณุงุช:\n`;
  if (returnPolicy) prompt += `- ุณูุงุณุฉ ุงูุฅุฑุฌุงุน: ${returnPolicy}\n`;
  if (exchangePolicy) prompt += `- ุณูุงุณุฉ ุงูุงุณุชุจุฏุงู: ${exchangePolicy}\n`;
  if (shippingPolicy) prompt += `- ุณูุงุณุฉ ุงูุดุญู: ${shippingPolicy}\n`;
  prompt += '\n';

  prompt += `๐ ุฑุงุจุท ุงููุชุฌุฑ: ${m.storeurl || 'https://example.com/'}\n\n`;

  if (template && template.trim()) {
    prompt += `## ุชุนูููุงุช ุฎุงุตุฉ ูู ุตุงุญุจ ุงููุชุฌุฑ:\n${template}\n\n`;
  }

  prompt += `ูู ููุงูุฉ ูู ุฑุฏุ ูู ูู: "ุญุงุจ ุฃุณุงุนุฏู ุจุดู ุซุงููุ ๐"`;

  return prompt;
}
